import{a as E,b as P,r as o,j as s}from"./index-B_YWOrie.js";import{api as v}from"./api-CYk9FEKy.js";import{L as F}from"./Loading-BvPCrw-b.js";import"./index-LMWlVbK9.js";/* empty css                */const W=({shop:m})=>{const[d]=E(),x=P(),i=m||d.get("shop"),[r,j]=o.useState(""),[a,n]=o.useState(null),[c,T]=o.useState(null),[p,f]=o.useState(!1),[y,B]=o.useState(new Set),[R,C]=o.useState(!1);o.useEffect(()=>{const e=()=>{const l=new Date,u=5.5*60*60*1e3;return new Date(l.getTime()+u).toISOString().split("T")[0]},t=d.get("date");j(t||e())},[d]),o.useEffect(()=>{i&&r&&(b(),A())},[i,r]);const A=async()=>{if(i)try{const e=await v.getShopBalance(i);e.success&&e.data&&C(e.data.isTestShop===!0)}catch(e){console.error("Error checking shop:",e),C(!1)}},b=async()=>{if(!(!i||!r))try{f(!0);const[e,t]=await Promise.all([v.getDailyBillingStats(i,r),v.getBillingBreakdown(i,r)]);e.success&&n(e.stats),t.success&&T(t.breakdown)}catch(e){console.error("Error loading call history:",e)}finally{f(!1)}},N=e=>{B(t=>{const l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l})},w=e=>{const t=e.length,l=e.filter(h=>h.status==="completed"||h.status==="connected").length,u=e.reduce((h,g)=>h+(g.duration||0),0),S=e.reduce((h,g)=>h+(g.cost||0),0);return{totalCalls:t,connectedCalls:l,totalDuration:u,totalCost:S}},k=e=>{if(!e)return"N/A";const t=new Date(e),l=5.5*60*60*1e3;return new Date(t.getTime()+l).toLocaleString("en-IN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})};return i?s.jsxs("div",{className:"call-history-page",children:[R&&s.jsx("div",{className:"blur-overlay",children:s.jsxs("div",{className:"overlay-content",children:[s.jsx("h2",{children:"Connect Your Shopify Store"}),s.jsx("p",{children:"Connect your store to view call history and billing data."}),s.jsx("button",{className:"connect-btn",onClick:()=>x("/integrations"),children:"Connect to Shopify"})]})}),s.jsxs("div",{className:"call-history-header-compact",children:[s.jsxs("div",{children:[s.jsx("h1",{children:"Call History"}),s.jsx("p",{className:"call-history-subtitle",children:"View detailed call history and billing breakdown by day"})]}),s.jsxs("div",{className:"call-history-header-actions",children:[s.jsx("input",{type:"date",id:"datePicker",className:"filter-date-compact",value:r,onChange:e=>{j(e.target.value),x(`/call-history?shop=${encodeURIComponent(i)}&date=${e.target.value}`)}}),s.jsx("button",{className:"refresh-btn-compact",onClick:b,disabled:p,children:p?s.jsxs(s.Fragment,{children:[s.jsx(F,{inline:!0,size:"small"}),"Loading..."]}):"Load History"})]})]}),a&&s.jsxs("div",{className:"stats-grid",children:[s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon-top-right",style:{background:"#ecfdf5",color:"#10b981"},children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("polyline",{points:"20 6 9 17 4 12"})})}),s.jsx("div",{className:"stat-label",children:"Calls Connected"}),s.jsx("div",{className:"stat-value",children:a.totalConnectedCalls||0})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon-top-right",style:{background:"#f3e8ff",color:"#8b5cf6"},children:s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:s.jsx("path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"})})}),s.jsx("div",{className:"stat-label",children:"Calls Initiated"}),s.jsx("div",{className:"stat-value",children:a.callsInitiated||a.totalCallsMade||0})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon-top-right",style:{background:"#f3e8ff",color:"#8b5cf6"},children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("polyline",{points:"12 6 12 12 16 14"})]})}),s.jsx("div",{className:"stat-label",children:"Total Talk Time"}),s.jsx("div",{className:"stat-value",children:(()=>{const e=a.totalDuration||0;if(e===0)return"0s";const t=Math.floor(e/60),l=e%60;return t>0?`${t}m ${l}s`:`${l}s`})()})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon-top-right",style:{background:"#fef3c7",color:"#f59e0b"},children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"18",y1:"20",x2:"18",y2:"10"}),s.jsx("line",{x1:"12",y1:"20",x2:"12",y2:"4"}),s.jsx("line",{x1:"6",y1:"20",x2:"6",y2:"14"})]})}),s.jsx("div",{className:"stat-label",children:"Pickup Rate"}),s.jsxs("div",{className:"stat-value",children:[a.pickupRate||0,"%"]})]}),s.jsxs("div",{className:"stat-card",children:[s.jsx("div",{className:"stat-icon-top-right",style:{background:"#dbeafe",color:"#3b82f6"},children:s.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[s.jsx("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),s.jsx("path",{d:"M17 5H9.5C8.57174 5 7.6815 5.36875 7.02513 6.02513C6.36875 6.6815 6 7.57174 6 8.5C6 9.42826 6.36875 10.3185 7.02513 10.9749C7.6815 11.6312 8.57174 12 9.5 12H14.5C15.4283 12 16.3185 12.3687 16.9749 13.0251C17.6312 13.6815 18 14.5717 18 15.5C18 16.4283 17.6312 17.3185 16.9749 17.9749C16.3185 18.6312 15.4283 19 14.5 19H6"})]})}),s.jsx("div",{className:"stat-label",children:"Total Billing Amount"}),s.jsxs("div",{className:"stat-value",children:["â‚¹",(a.totalAmount||0).toFixed(2)]})]})]}),s.jsxs("div",{className:"call-history-table",children:[s.jsx("div",{className:"table-header",children:s.jsx("h3",{children:"Call Breakdown"})}),s.jsx("div",{className:"call-history-content",children:c?s.jsxs(s.Fragment,{children:[c.dashboardCalls&&c.dashboardCalls.length>0&&s.jsx(D,{type:"Dashboard Calls",calls:c.dashboardCalls,calculateStats:w,expanded:y.has("dashboard"),onToggle:()=>N("dashboard"),formatDate:k}),c.csvCalls&&Object.entries(c.csvCalls).map(([e,t])=>s.jsx(D,{type:e,calls:t,calculateStats:w,expanded:y.has(`csv-${e}`),onToggle:()=>N(`csv-${e}`),formatDate:k},e))]}):s.jsxs("div",{style:{padding:40,textAlign:"center",color:"#666"},children:[s.jsx("div",{style:{fontSize:48,marginBottom:16},children:"ðŸ“ž"}),s.jsx("div",{children:"No call data available for this date"})]})})]})]}):s.jsx("div",{className:"call-history-page",children:s.jsx("div",{className:"error-message",children:"No shop parameter found. Please select a shop."})})},D=({type:m,calls:d,calculateStats:x,expanded:i,onToggle:r,formatDate:j})=>{const a=x(d);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"table-row",onClick:r,children:s.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs("div",{children:[s.jsx("div",{className:"call-type",children:m}),s.jsxs("div",{className:"call-stats",children:[a.totalCalls," calls (",a.connectedCalls," connected) â€¢ ",a.totalDuration,"s â€¢ â‚¹",a.totalCost.toFixed(2)]})]}),s.jsxs("div",{className:"cost-info",children:["â‚¹",a.totalCost.toFixed(2)]})]})}),i&&s.jsx("div",{className:"expandable-content show",children:s.jsxs("table",{className:"order-details-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Order #"}),s.jsx("th",{children:"Customer"}),s.jsx("th",{children:"Phone"}),s.jsx("th",{children:"Call Time"}),s.jsx("th",{children:"Duration"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Cost"})]})}),s.jsx("tbody",{children:d.map((n,c)=>s.jsxs("tr",{children:[s.jsx("td",{children:n.orderNumber||"-"}),s.jsx("td",{children:n.customerName||"-"}),s.jsx("td",{children:n.customerPhone||"-"}),s.jsx("td",{children:j(n.startedAt||n.createdAt)}),s.jsxs("td",{children:[n.duration||0,"s"]}),s.jsx("td",{children:n.status||"unknown"}),s.jsxs("td",{children:["â‚¹",(n.cost||0).toFixed(2)]})]},c))})]})})]})};export{W as default};

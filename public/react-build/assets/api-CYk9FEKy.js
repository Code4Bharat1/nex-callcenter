const o={async fetch(e,t={}){const r={credentials:"include",headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0",...t.headers}};try{const n=await window.fetch(`${e}`,{...r,...t,cache:"no-store"}),a=(n.headers.get("content-type")||"").includes("application/json");if(!n.ok){let i;if(a)try{i=await n.json()}catch{i={error:await n.text()||`HTTP ${n.status}`}}else i={error:await n.text()||`HTTP ${n.status}: ${n.statusText}`};throw new Error(i.error||`HTTP ${n.status}: ${n.statusText}`)}if(a)try{return await n.json()}catch(i){const u=await n.text();throw console.error(`API Error [${e}]: Failed to parse JSON response:`,i),new Error(`Invalid JSON response from server: ${u.substring(0,100)}`)}else{const i=await n.text();throw new Error(`Server returned non-JSON response: ${i.substring(0,100)}`)}}catch(n){throw console.error(`API Error [${e}]:`,n),n}},async getShopBalance(e){if(!e)throw new Error("Shop parameter required");return this.fetch(`/api/shop-balance?shop=${encodeURIComponent(e)}`)},async getPlanUsage(e,t=null,r=null){if(!e)throw new Error("Shop parameter required");let n=`/api/plan-usage?shop=${encodeURIComponent(e)}`;return t&&(n+=`&startDate=${encodeURIComponent(t)}`),r&&(n+=`&endDate=${encodeURIComponent(r)}`),this.fetch(n)},async getSystemStatus(e){if(!e)throw new Error("Shop parameter required");return this.fetch(`/api/system-status-check?shop=${encodeURIComponent(e)}`)},async getCallsLastHour(e){if(!e)throw new Error("Shop parameter required");return this.fetch(`/api/calls-last-hour?shop=${encodeURIComponent(e)}`)},async getCallsPerHour(e,t=24){if(!e)throw new Error("Shop parameter required");return this.fetch(`/api/calls-per-hour?shop=${encodeURIComponent(e)}&hoursBack=${t}`)},async getOrders(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/orders?${r.toString()}`)},async getAbandonedCheckouts(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/abandoned-checkouts?${r.toString()}`)},async getLowIntentOrders(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/low-intent-orders?${r.toString()}`)},async getScripts(e){const t=new URLSearchParams;return e&&t.set("shop",e),t.set("_t",Date.now().toString()),this.fetch(`/api/scripts?${t.toString()}`)},async createScript(e,t){const r=e?`?shop=${encodeURIComponent(e)}`:"";return this.fetch(`/api/scripts${r}`,{method:"POST",body:JSON.stringify(t)})},async updateScript(e,t,r){const n=t?`?shop=${encodeURIComponent(t)}`:"";return this.fetch(`/api/scripts/${e}${n}`,{method:"PUT",body:JSON.stringify(r)})},async deleteScript(e,t){const r=t?`?shop=${encodeURIComponent(t)}`:"";return this.fetch(`/api/scripts/${e}${r}`,{method:"DELETE"})},async getKnowledgeBooks(e){const t=e?`?shop=${encodeURIComponent(e)}`:"";return this.fetch(`/api/knowledge-books${t}`)},async createKnowledgeBook(e,t){const r=e?`?shop=${encodeURIComponent(e)}`:"";return this.fetch(`/api/knowledge-books${r}`,{method:"POST",body:JSON.stringify(t)})},async updateKnowledgeBook(e,t,r){const n=t?`?shop=${encodeURIComponent(t)}`:"";return this.fetch(`/api/knowledge-books/${e}${n}`,{method:"PUT",body:JSON.stringify(r)})},async deleteKnowledgeBook(e,t){const r=t?`?shop=${encodeURIComponent(t)}`:"";return this.fetch(`/api/knowledge-books/${e}${r}`,{method:"DELETE"})},async getCallHistory(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/call-history?${r.toString()}`)},async getUsageData(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/usage-data?${r.toString()}`)},async getDailyCallVolume(e){if(!e)throw new Error("Shop parameter required");return this.fetch(`/api/daily-call-volume?shop=${encodeURIComponent(e)}`)},async getVoices(e="",t){const r=new URLSearchParams;return t&&r.append("shop",t),e&&r.append("q",e),this.fetch(`/api/cartesia/voices?${r.toString()}`)},async previewVoice(e,t="This is a preview of this voice. How does it sound?",r=null){throw new Error("Voice generation is disabled. Please use pre-generated audio files only.")},async previewSarvamVoice(e,t="This is a preview of this voice. How does it sound?",r=null){throw new Error("Voice generation is disabled. Please use pre-generated audio files only.")},async cloneVoice(e,t){const r=e?`?shop=${encodeURIComponent(e)}`:"";return window.fetch(`/api/cartesia/voices/clone${r}`,{method:"POST",credentials:"include",body:t}).then(n=>{if(!n.ok)throw new Error(`HTTP ${n.status}`);return n.json()})},async getShopifyConnection(e){const t=e?`?shop=${encodeURIComponent(e)}`:"";return this.fetch(`/api/shopify/connection${t}`)},async connectShopify(e,t){return this.fetch("/api/shopify/connect",{method:"POST",body:JSON.stringify({shopUrl:e,accessToken:t})})},async disconnectShopify(e){return this.fetch(`/api/shopify/disconnect/${e}`,{method:"POST"})},async getUserProfile(){return this.fetch("/api/user/profile")},async updateUserProfile(e,t,r){return this.fetch("/api/user/profile",{method:"POST",body:JSON.stringify({name:e,avatar:t,phone:r})})},async getPerformanceData(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/performance-data?${r.toString()}`)},async getAiCalls(e,t={}){if(!e)throw new Error("Shop parameter required");const r=new URLSearchParams({shop:e,...t});return this.fetch(`/api/ai-calls?${r.toString()}`)},async getDailyBillingStats(e,t,r){if(!e)throw new Error("Shop parameter required");const n=new URLSearchParams({shop:e});return t&&n.append("startDate",t),r&&n.append("endDate",r),t&&!r&&n.append("date",t),this.fetch(`/api/daily-billing-stats?${n.toString()}`)},async getBillingBreakdown(e,t,r){if(!e)throw new Error("Shop parameter required");const n=new URLSearchParams({shop:e});return t&&n.append("startDate",t),r&&n.append("endDate",r),t&&!r&&n.append("date",t),this.fetch(`/api/billing-breakdown?${n.toString()}`)},async exportUsageData(e){if(!e)throw new Error("Shop parameter required");const t=`/api/usage-export?shop=${encodeURIComponent(e)}`,r=await window.fetch(t,{credentials:"include"});if(!r.ok)throw new Error(`HTTP ${r.status}`);const n=await r.blob(),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=`usage-data-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(s)},async getTestOrders(e){const t=e?`?shop=${encodeURIComponent(e)}`:"";return this.fetch(`/api/test-orders${t}`)},async createTestOrder(e,t){const r=e?`?shop=${encodeURIComponent(e)}`:"";return this.fetch(`/api/test-orders${r}`,{method:"POST",body:JSON.stringify(t)})},async queueTestOrder(e,t,r){return this.fetch("/api/set-queue",{method:"POST",body:JSON.stringify({orderId:e,shop:r,scriptId:t})})},async updateOrderScript(e,t,r){const n=r?`?shop=${encodeURIComponent(r)}`:"";return this.fetch(`/api/orders/${e}/script${n}`,{method:"POST",body:JSON.stringify({scriptId:t})})},async makeTestCall(e){return this.fetch("/api/test-call",{method:"POST",body:JSON.stringify({order_id:e})})},async setDefaultScript(e,t){const r=t?`?shop=${encodeURIComponent(t)}`:"";return this.fetch(`/api/scripts/${e}/default${r}`,{method:"POST"})},async generateScriptWithClaude(e,t){return this.fetch("/api/claude/generate-script",{method:"POST",body:JSON.stringify({prompt:e,currentScript:t,stream:!1})})},async getEvaluationTestCases(){return this.fetch("/api/evaluation/test-cases")},async getEvaluationDefaultPrompts(){return this.fetch("/api/evaluation/default-prompts")},async extractEvaluationRules(e,t=null){return this.fetch("/api/evaluation/extract-rules",{method:"POST",body:JSON.stringify({scriptContent:e,extractorPrompt:t})})},async runEvaluation(e){return this.fetch("/api/evaluation/run",{method:"POST",body:JSON.stringify(e)})},async*generateScriptWithClaudeStream(e,t,r="simple",n=null,s){console.log("[API] Sending generationMode:",r,"| Type:",typeof r,"| JSON:",JSON.stringify({prompt:e.substring(0,50)+"...",currentScript:t?"exists":"null",generationMode:r,stream:!0}));const a=await fetch("/api/claude/generate-script",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,currentScript:t,generationMode:r,stream:!0}),signal:n});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const i=a.body.getReader(),u=new TextDecoder;let d="";try{for(;;){if(n&&n.aborted)throw i.cancel(),new DOMException("The operation was aborted.","AbortError");const{done:f,value:y}=await i.read();if(f)break;d+=u.decode(y,{stream:!0});const h=d.split(`
`);d=h.pop()||"";for(const l of h)if(l.startsWith("data: ")){const p=l.slice(6).trim();if(!p||p==="[DONE]")continue;try{const c=JSON.parse(p);if(c.chunk)s(c.chunk),yield c.chunk;else{if(c.done)return;if(c.error)throw new Error(c.error)}}catch{}}}}finally{i.releaseLock()}},async fetchWebsiteContent(e){return this.fetch("/api/claude/fetch-website",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({websiteUrl:e})})},async generateScriptWithClaudeSecure(e,t="simple",r=null){console.log("[API] Calling secure generate script...");const n=await fetch("/api/claude/generate-script-secure",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,generationMode:t}),signal:r});if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const s=await n.json();if(s.error)throw new Error(s.error);return console.log("[API] Secure generation complete:",{success:s.success,lineCount:s.lineCount,wordCount:s.wordCount}),s},async getTranscriptAnalytics(e,t,r){const n=new URLSearchParams;return e&&n.append("limit",e),t&&n.append("scriptId",t),r&&n.append("shop",r),this.fetch(`/api/transcript-analytics?${n.toString()}`)}};function w(e){return o.getScripts(e)}function m(e,t){return o.createScript(t,e)}function S(e,t,r){return o.updateScript(e,r,t)}function g(e,t){return o.deleteScript(e,t)}function P(e){return o.getTestOrders(e)}function $(e,t){return o.createTestOrder(t,e)}function T(e){return o.getKnowledgeBooks(e)}function O(e,t){return o.createKnowledgeBook(e,t)}function C(e,t,r){return o.updateKnowledgeBook(e,t,r)}function E(e,t){return o.deleteKnowledgeBook(e,t)}function b(e,t,r){return o.queueTestOrder(e,t,r)}function U(e,t,r){return o.updateOrderScript(e,t,r)}function k(e,t){return o.makeTestCall(e,t)}function q(e,t){return o.getVoices(e,t)}function R(e,t){return o.previewVoice(e,t)}function I(e,t){return o.setDefaultScript(e,t)}export{o as api,O as createKnowledgeBook,m as createScript,$ as createTestOrder,E as deleteKnowledgeBook,g as deleteScript,w as getCallScripts,T as getKnowledgeBooks,P as getTestOrders,q as getVoices,k as makeTestCall,R as previewVoice,b as queueTestOrder,I as setDefaultScript,C as updateKnowledgeBook,U as updateOrderScript,S as updateScript};

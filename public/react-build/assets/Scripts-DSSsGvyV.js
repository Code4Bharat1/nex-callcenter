import{r as l,j as e}from"./index-B_YWOrie.js";import{getCallScripts as H,setDefaultScript as G,deleteScript as Y,createScript as A,updateScript as W,previewVoice as q,getVoices as Q}from"./api-CYk9FEKy.js";const J=[{id:1,name:"Order Confirmation Call",content:"Hello! This is [Your Name] calling from [Company Name]. I'm calling to confirm your recent order #[ORDER_NUMBER] for [ORDER_AMOUNT]. I wanted to verify your delivery address and ensure everything is on track for delivery. Could you please confirm if the address [CUSTOMER_ADDRESS] is correct for delivery? Also, would you prefer any specific delivery time or have any special instructions? Thank you for choosing us!",isActive:!1},{id:2,name:"Address Verification Call",content:"Hi there! This is [Your Name] from [Company Name]. I'm calling regarding your order #[ORDER_NUMBER]. I noticed your delivery address might need some clarification. Could you please confirm the complete address including any landmarks or specific directions that would help our delivery team locate your place easily? This will ensure smooth and timely delivery of your order.",isActive:!1},{id:3,name:"Follow-up Call",content:"Hello! This is [Your Name] calling from [Company Name]. I hope you're doing well! I'm following up on your recent order #[ORDER_NUMBER] that was delivered on [DELIVERY_DATE]. I wanted to check if everything arrived as expected and if you're satisfied with your purchase. Is there anything we could have done better? Your feedback helps us improve our service.",isActive:!1},{id:4,name:"Payment Confirmation Call",content:"Good day! This is [Your Name] from [Company Name]. I'm calling regarding your order #[ORDER_NUMBER] for [ORDER_AMOUNT]. I wanted to confirm that your payment has been processed successfully. Your order is now being prepared for shipment. You'll receive a tracking number once it's shipped. Is there anything else you'd like to know about your order?",isActive:!1}],x=s=>{if(!s)return"";const d=document.createElement("div");return d.textContent=s,d.innerHTML};function X({shop:s}){const[d,v]=l.useState([]),[T,j]=l.useState(!0),[D,g]=l.useState(!1),[y,f]=l.useState(null),[I,C]=l.useState(!1),[P,S]=l.useState([]),[R,E]=l.useState(""),[o,m]=l.useState({name:"",description:"",content:"",scriptContentVisible:"",scriptContentHidden:"",voiceId:"",initialGreeting:"",prePhrase:"ji",useCustomAnalysis:!1,customAnalysisPrompt:"",disableUnder35Retries:!1,ttsProvider:null});l.useEffect(()=>{p()},[s]);const p=async()=>{try{j(!0);const i=(await H(s)).scripts||[];console.log("[Scripts] Loaded scripts:",i.length),i.length>0&&console.log("[Scripts] First script sample:",{id:i[0].id,name:i[0].name,hasContent:!!i[0].content,contentLength:i[0].content?.length||0,hasFrontendDisplayScript:!!i[0].frontendDisplayScript,frontendDisplayScriptLength:i[0].frontendDisplayScript?.length||0,fullScript:i[0]}),v(i)}catch(t){console.error("Error loading scripts:",t),v([])}finally{j(!1)}},N=()=>{f(null),m({name:"",description:"",content:"",voiceId:"",initialGreeting:"",prePhrase:"ji",useCustomAnalysis:!1,customAnalysisPrompt:"",disableUnder35Retries:!1}),g(!0)},U=t=>{console.log("[Scripts] Editing script:",t),console.log("[Scripts] Script content:",t.content),console.log("[Scripts] Script scriptContentVisible:",t.scriptContentVisible),console.log("[Scripts] Script scriptContentHidden:",t.scriptContentHidden),f(t.id);const i=t.scriptContentVisible||t.content||"",r=t.scriptContentHidden||"";m({name:t.name||"",description:t.description||"",content:i,scriptContentVisible:i,scriptContentHidden:r,voiceId:t.voiceId||"",initialGreeting:t.initialGreeting||"",prePhrase:t.prePhrase||"ji",useCustomAnalysis:t.useCustomAnalysis||!1,customAnalysisPrompt:t.customAnalysisPrompt||"",disableUnder35Retries:t.disableUnder35Retries||!1}),g(!0)},b=()=>{g(!1),f(null)},a=t=>{const{name:i,value:r,type:n,checked:c}=t.target;m(u=>({...u,[i]:n==="checkbox"?c:r}))},V=async t=>{t.preventDefault();try{let i;y?i=await W(y,o,s):i=await A(o,s),i.success?(await p(),b()):alert(i.error||"Failed to save script")}catch(i){console.error("Error saving script:",i),alert("Error saving script")}},_=async t=>{if(window.confirm("Are you sure you want to delete this script?"))try{const i=await Y(t,s);i.success?await p():alert(i.error||"Failed to delete script")}catch(i){console.error("Error deleting script:",i),alert("Error deleting script")}},F=async t=>{try{const i=await G(t,s);i.success?await p():alert(i.error||"Failed to set default script")}catch(i){console.error("Error setting default script:",i),alert("Error setting default script")}},M=async(t,i)=>{try{const r=await A({name:t+" (Copy)",content:i,description:"Added from default scripts"},s);r.success?await p():alert(r.error||"Failed to add default script")}catch(r){console.error("Error adding default script:",r),alert("Error adding default script")}},z=()=>{C(!0),w()},h=()=>{C(!1)},w=async(t="")=>{try{const i=await Q(t,s);S(i.voices||[])}catch(i){console.error("Error fetching voices:",i),S([])}},k=()=>{w(R)},O=t=>{m(i=>({...i,voiceId:t})),h()},L=async(t,i)=>{const r=i.textContent;i.textContent="Playing...",i.disabled=!0;try{const n=await q(t),c=URL.createObjectURL(n),u=new Audio(c);u.onended=()=>{URL.revokeObjectURL(c),i.textContent=r,i.disabled=!1},u.onerror=()=>{URL.revokeObjectURL(c),i.textContent=r,i.disabled=!1,alert("Failed to play preview")},await u.play()}catch(n){console.error("Preview error:",n),i.textContent=r,i.disabled=!1,alert("Failed to generate preview: "+n.message)}},B=async(t,i)=>{try{await navigator.clipboard.writeText(t);const r=i.textContent;i.textContent="Copied!",i.style.background="#10b981",setTimeout(()=>{i.textContent=r,i.style.background="#0073e6"},2e3)}catch{const n=document.createElement("textarea");n.value=t,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select();try{document.execCommand("copy");const c=i.textContent;i.textContent="Copied!",i.style.background="#10b981",setTimeout(()=>{i.textContent=c,i.style.background="#0073e6"},2e3)}catch{alert("Failed to copy. Voice ID: "+t)}document.body.removeChild(n)}};return T?e.jsx("div",{className:"scripts-container",children:e.jsx("div",{style:{textAlign:"center",padding:"40px"},children:"Loading..."})}):e.jsxs("div",{className:"scripts-container",children:[e.jsx("section",{className:"script-section",children:e.jsxs("div",{className:"welcome-message",style:{background:"#e8f5e8",border:"1px solid #50b83c",borderRadius:"8px",padding:"16px",marginBottom:"24px"},children:[e.jsx("h3",{style:{margin:"0 0 8px 0",color:"#50b83c"},children:"ðŸŽ¯ Welcome to Call Agents!"}),e.jsx("p",{style:{margin:"0",color:"#202223"},children:`Create and manage your call agents here. When you click "Set Queue" on an order, you'll be prompted to select an agent for that call.`})]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"32px"},children:[e.jsxs("section",{className:"script-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("button",{className:"btn btn-primary",onClick:N,children:"Create New Script"})}),e.jsx("div",{id:"user-scripts",children:d&&d.length>0?d.map(t=>{const i=t.voiceId||t.initialGreeting||t.prePhrase||t.useCustomAnalysis||t.customAnalysisPrompt||t.disableUnder35Retries;return e.jsxs("div",{className:"script-card",children:[e.jsxs("div",{className:"script-header",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"script-name",children:[x(t.name),t.isActive&&e.jsx("span",{style:{color:"#50b83c",fontSize:"12px"},children:" (Default)"})]}),t.description&&e.jsx("div",{style:{color:"#6d7175",fontSize:"14px"},children:x(t.description)}),i&&e.jsxs("div",{style:{marginTop:"8px"},children:[e.jsx("span",{style:{background:"#5c6ac4",color:"white",padding:"2px 8px",borderRadius:"12px",fontSize:"10px",marginRight:"4px"},children:"ðŸŽ›ï¸ Custom"}),t.voiceId&&e.jsx("span",{style:{background:"#e1e5e9",color:"#202223",padding:"2px 6px",borderRadius:"8px",fontSize:"10px",marginRight:"4px"},children:"Voice"}),t.initialGreeting&&e.jsx("span",{style:{background:"#e1e5e9",color:"#202223",padding:"2px 6px",borderRadius:"8px",fontSize:"10px",marginRight:"4px"},children:"Hindi"}),t.useCustomAnalysis&&e.jsx("span",{style:{background:"#e1e5e9",color:"#202223",padding:"2px 6px",borderRadius:"8px",fontSize:"10px",marginRight:"4px"},children:"AI"}),t.disableUnder35Retries&&e.jsx("span",{style:{background:"#e1e5e9",color:"#202223",padding:"2px 6px",borderRadius:"8px",fontSize:"10px",marginRight:"4px"},children:"No Retry"})]})]}),e.jsxs("div",{className:"script-actions",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>U(t),children:"Edit"}),!t.isActive&&e.jsx("button",{className:"btn btn-success",onClick:()=>F(t.id),children:"Set Default"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>_(t.id),children:"Delete"})]})]}),e.jsxs("div",{className:"script-content",children:[x((t.scriptContentVisible||t.content||"").substring(0,200)),(t.scriptContentVisible||t.content||"").length>200?"...":""]})]},t.id)}):e.jsxs("div",{className:"script-card",style:{textAlign:"center",padding:"40px"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"ðŸ“"}),e.jsx("h3",{style:{margin:"0 0 8px 0",color:"#202223"},children:"No scripts created yet"}),e.jsx("p",{style:{margin:"0 0 24px 0",color:"#6d7175"},children:"Create your first script or add one from the default templates on the right."}),e.jsx("button",{className:"btn btn-primary",onClick:N,children:"Create Your First Script"})]})})]}),e.jsxs("section",{className:"script-section",children:[e.jsx("div",{className:"section-header",children:e.jsx("p",{style:{margin:"0",color:"#6d7175",fontSize:"14px"},children:"Pre-built templates you can add to your account"})}),e.jsx("div",{id:"default-scripts",children:J.map(t=>e.jsxs("div",{className:"script-card default-script",children:[e.jsxs("div",{className:"script-header",children:[e.jsxs("div",{children:[e.jsx("div",{className:"script-name",children:x(t.name)}),e.jsx("div",{style:{color:"#6d7175",fontSize:"14px"},children:"Pre-built template"})]}),e.jsx("button",{className:"btn",onClick:()=>M(t.name,t.content),children:"Add Script"})]}),e.jsxs("div",{className:"script-content",children:[x(t.content.substring(0,200)),t.content.length>200?"...":""]})]},t.id))})]})]}),D&&e.jsx("div",{className:"modal",style:{display:"block"},onClick:t=>{t.target.classList.contains("modal")&&b()},children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"800px",maxHeight:"90vh",overflowY:"auto"},children:[e.jsx("h3",{id:"modalTitle",children:y?"Edit Script":"Create New Script"}),e.jsxs("form",{id:"scriptForm",onSubmit:V,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"scriptName",children:"Script Name"}),e.jsx("input",{type:"text",id:"scriptName",name:"name",value:o.name,onChange:a,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"scriptDescription",children:"Description (Optional)"}),e.jsx("input",{type:"text",id:"scriptDescription",name:"description",value:o.description,onChange:a})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"scriptContent",children:"Script Content"}),e.jsx("textarea",{id:"scriptContent",name:"content",value:o.content,onChange:a,required:!0,placeholder:"Enter your call script here..."}),e.jsxs("div",{style:{marginTop:"8px",fontSize:"12px",color:"#6d7175"},children:[e.jsx("strong",{children:"Template Variables:"})," [ORDER_NUMBER], [ORDER_AMOUNT], [CUSTOMER_NAME], [CUSTOMER_ADDRESS], [DELIVERY_DATE]"]})]}),e.jsxs("div",{style:{borderTop:"2px solid #e1e5e9",paddingTop:"20px",marginTop:"20px"},children:[e.jsx("h4",{style:{color:"#202223",marginBottom:"15px"},children:"ðŸŽ›ï¸ Custom Script Features"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"voiceId",children:"Voice"}),e.jsxs("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[e.jsx("input",{type:"text",id:"voiceId",name:"voiceId",value:o.voiceId,onChange:a,placeholder:"voice id",style:{flex:1}}),e.jsx("button",{type:"button",id:"openVoiceSearch",style:{padding:"8px 12px"},onClick:z,children:"Search voices"})]}),e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#6d7175"},children:"Select from Cartesia catalogue or paste a voice id"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"initialGreeting",children:"Initial Greeting"}),e.jsx("textarea",{id:"initialGreeting",name:"initialGreeting",value:o.initialGreeting,onChange:a,placeholder:"Hello {{customer_name}} ji se baat ho rahi hai?"}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"12px",color:"#6d7175"},children:["First greeting when call connects. Use ",{customer_name}," for customer name placeholder"]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"prePhrase",children:"Pre-phrase Text"}),e.jsx("input",{type:"text",id:"prePhrase",name:"prePhrase",value:o.prePhrase,onChange:a,placeholder:"ji"}),e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#6d7175"},children:"Short acknowledgment spoken after customer speaks (e.g., 'ji', 'okay', 'yes')"})]}),e.jsxs("div",{style:{border:"1px solid #e1e5e9",borderRadius:"8px",padding:"15px",marginTop:"15px",background:"#f8f9fa"},children:[e.jsx("h5",{style:{color:"#202223",marginBottom:"10px"},children:"ðŸ¤– Custom Analysis Settings"}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",id:"useCustomAnalysis",name:"useCustomAnalysis",checked:o.useCustomAnalysis,onChange:a}),e.jsx("span",{children:"Use Custom Analysis Method"})]}),e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#6d7175"},children:"Enable custom GPT analysis for this script"})]}),o.useCustomAnalysis&&e.jsxs("div",{className:"form-group",id:"customAnalysisPromptGroup",children:[e.jsx("label",{htmlFor:"customAnalysisPrompt",children:"Custom Analysis Prompt"}),e.jsx("textarea",{id:"customAnalysisPrompt",name:"customAnalysisPrompt",value:o.customAnalysisPrompt,onChange:a,placeholder:"Analyze this call transcript to determine if customer wants to confirm their order (return 'change address'), cancel their order (return 'cancelled'), or needs manual help (return 'Handle Manually'). Provide interest score 0-10 and brief summary. Respond in JSON format with fields: call_outcome_category, call_interest_score, call_summary, address_change_requested, new_address, forensic_breakdown."}),e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#6d7175"},children:"Custom GPT prompt for call analysis. For order confirmation calls, use 'change address' for order confirmed, 'cancelled' for order cancelled. Must return JSON with required fields."})]}),e.jsxs("div",{className:"form-group",children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("input",{type:"checkbox",id:"disableUnder35Retries",name:"disableUnder35Retries",checked:o.disableUnder35Retries,onChange:a}),e.jsx("span",{children:"Disable Early Disconnect Retry Logic"})]}),e.jsx("div",{style:{marginTop:"4px",fontSize:"12px",color:"#6d7175"},children:"Disable automatic retries for early disconnect calls"})]})]})]}),e.jsxs("div",{className:"form-group",style:{marginTop:"20px"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Script"}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:b,children:"Cancel"})]})]})]})}),I&&e.jsx("div",{id:"voiceSearchModal",style:{display:"block",position:"fixed",inset:"0",background:"rgba(0,0,0,0.4)",zIndex:9999},onClick:t=>{t.target.id==="voiceSearchModal"&&h()},children:e.jsxs("div",{style:{maxWidth:"720px",margin:"60px auto",background:"#fff",borderRadius:"12px",padding:"16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"12px"},children:[e.jsx("h3",{style:{margin:0},children:"Select a voice"}),e.jsx("button",{id:"closeVoiceSearch",onClick:h,style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer"},children:"Ã—"})]}),e.jsxs("div",{style:{display:"flex",gap:"8px",marginBottom:"12px"},children:[e.jsx("input",{id:"voiceSearchInput",placeholder:"Search by name/language",value:R,onChange:t=>E(t.target.value),onKeyPress:t=>{t.key==="Enter"&&k()},style:{flex:1,padding:"8px 10px",border:"1px solid #d1d5db",borderRadius:"8px"}}),e.jsx("button",{id:"voiceSearchBtn",onClick:k,style:{padding:"8px 12px"},children:"ðŸ”"})]}),e.jsx("div",{id:"voiceList",style:{maxHeight:"380px",overflow:"auto",border:"1px solid #e5e7eb",borderRadius:"8px",padding:"8px"},children:P.map(t=>e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px",borderBottom:"1px solid #f3f4f6"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"600"},children:t.name||"Untitled"}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280"},children:t.language||""}),e.jsx("div",{style:{fontSize:"12px",color:"#6b7280",maxWidth:"520px"},dangerouslySetInnerHTML:{__html:(t.description||"").replace(/</g,"&lt;")}})]}),e.jsxs("div",{children:[e.jsx("button",{"data-id":t.id,className:"previewVoiceBtn",onClick:i=>L(t.id,i.target),style:{padding:"6px 10px",marginRight:"4px",background:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer"},children:"Preview"}),e.jsx("button",{"data-id":t.id,className:"copyVoiceBtn",onClick:i=>B(t.id,i.target),style:{padding:"6px 10px",background:"#0073e6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Copy ID"}),e.jsx("button",{onClick:()=>O(t.id),style:{padding:"6px 10px",marginLeft:"4px",background:"#10b981",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Select"})]})]},t.id))}),e.jsx("div",{style:{marginTop:"12px",display:"flex",justifyContent:"flex-end",gap:"8px"},children:e.jsx("button",{id:"createVoiceBtn",onClick:()=>{h(),window.location.href="/voices"+(s?`?shop=${encodeURIComponent(s)}`:"")},style:{padding:"8px 12px"},children:"Create voice"})})]})})]})}export{X as default};
